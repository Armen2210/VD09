from flask import Flask  # Импортируем класс Flask — основной объект веб-приложения
from flask_sqlalchemy import SQLAlchemy  # Импортируем SQLAlchemy для работы с базой данных
from flask_login import LoginManager  # Импортируем LoginManager для управления сессиями пользователей
from flask_bcrypt import Bcrypt  # Импортируем Bcrypt для безопасного хэширования паролей

# Создаём экземпляр приложения Flask.
# __name__ говорит Flask, где искать шаблоны, статические файлы и т.п.
app = Flask(__name__)

# Настройки приложения. Секретный ключ используется для защиты форм, сессий и токенов.
# В учебном примере он прописан в коде, но в реальном проекте его хранят в переменных окружения.
app.config['SECRET_KEY'] = 'your-secret-key'

# Настройка строки подключения к базе данных.
# Здесь используется SQLite и файл базы данных clicker.db, который будет лежать в папке instance.
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///clicker.db'

# Создаем объект базы данных, связанный с нашим приложением Flask.
# db будет использоваться в других файлах (например, models.py) для описания таблиц.
db = SQLAlchemy(app)

# Создаём объект Bcrypt для хэширования и проверки паролей.
# Он будет использоваться в routes.py при регистрации и авторизации пользователей.
bcrypt = Bcrypt(app)

# Создаём менеджер входа пользователей.
# Связываем LoginManager с нашим приложением Flask.
login_manager = LoginManager(app)

# Указываем, на какое представление (роут) нужно перенаправлять
# неавторизованных пользователей при попытке доступа к защищённым страницам.
# 'login' — это имя функции-обработчика из файла routes.py (@app.route('/login')).
login_manager.login_view = 'login'

# Импортируем модули routes и models из пакета app.
# Это нужно для того, чтобы:
#  - зарегистрировать маршруты (роуты) приложения (routes.py),
#  - загрузить описание моделей базы данных (models.py).
# Важно: импорт делается в конце, чтобы избежать циклического импорта
# (routes и models тоже используют объекты app, db, login_manager).
from app import routes, models
